ERROR ~ Error executing process > 'DRAFT_SELECTION (test)'

Caused by:
  Process `DRAFT_SELECTION (test)` terminated with an error exit status (127)


Command executed:

  # Split corrected reads into individual files (one read per file)
     split -l 2 corrected.fasta split_reads_
  
     # Create list of read files
     find . -name "split_reads_*" -type f > read_list.txt
  
     # Count reads
     N_READS=$(wc -l < read_list.txt)
  
     if [ $N_READS -eq 0 ]; then
         echo "ERROR: No reads found in corrected reads file" >&2
         exit 1
     elif [ $N_READS -eq 1 ]; then
         # Only one read - use it as draft
         echo "INFO: Only 1 read available, using it as draft" >&2
         DRAFT_FILE=$(head -n1 read_list.txt)
         cat $DRAFT_FILE > test_cluster5_draft.fasta
         DRAFT_ID=$(head -n1 test_cluster5_draft.fasta | sed 's/>//g')
  
         # Create empty ANI results (no comparison needed)
         echo -e "query\treference\tANI\tmatches\ttotal_frags" > test_cluster5.ani.tsv
  
         # Statistics
         cat <<-EOF > test_cluster5.selection.json
  {
    "n_reads": 1,
    "draft_id": "$DRAFT_ID",
    "avg_ani": null,
    "selection_method": "single_read",
    "cluster_id": "5"
  }
  EOF
     else
         # Multiple reads - run fastANI all-vs-all
         echo "INFO: Running fastANI on $N_READS reads" >&2
  
         fastANI \
             --ql read_list.txt \
             --rl read_list.txt \
             -o test_cluster5.ani.tsv \
             -t 2 \
             -k 16 \
             --fragLen 160 \
  
  
         # Calculate average ANI for each read
         # Format: query ref ANI matches total
         # For each read, calculate average ANI to all other reads
         DRAFT_FILE=$(awk 'NR>1 {
             name[$1] = $1
             arr[$1] += $3
             count[$1] += 1
         }
         END {
             for (a in arr) {
                 print arr[a] / count[a], name[a]
             }
         }' test_cluster5.ani.tsv | sort -rg | head -n1 | cut -d " " -f2)
  
         # Extract draft read
         cat $DRAFT_FILE > test_cluster5_draft.fasta
         DRAFT_ID=$(head -n1 test_cluster5_draft.fasta | sed 's/>//g')
  
         # Get average ANI for the selected draft
         AVG_ANI=$(awk -v draft="$DRAFT_FILE" 'NR>1 {
             if ($1 == draft) {
                 arr[$1] += $3
                 count[$1] += 1
             }
         }
         END {
             for (a in arr) {
                 print arr[a] / count[a]
             }
         }' test_cluster5.ani.tsv)
  
         # Statistics
         cat <<-EOF > test_cluster5.selection.json
  {
    "n_reads": $N_READS,
    "draft_id": "$DRAFT_ID",
    "avg_ani": $AVG_ANI,
    "selection_method": "fastani_max_avg",
    "cluster_id": "5"
  }
  EOF
  
         echo "âœ“ Selected draft: $DRAFT_ID (avg ANI: $AVG_ANI)" >&2
     fi
  
     # Version tracking
     cat <<-END_VERSIONS > versions.yml
     "DRAFT_SELECTION":
         fastani: $(fastANI --version 2>&1 | grep -oP '(?<=version )\S+' || echo "1.33")
     END_VERSIONS

Command exit status:
  127

Command output:
  (empty)

Command error:
  INFO: Running fastANI on 203 reads
  .command.sh: line 39: fastANI: command not found

Work dir:
  /Users/andreassjodin/Code/NanoPulse/.nf-test/tests/e8f1606feecc39d60e7dac5d5ceb3e27/work/08/8329da3f5458c76006281d2f1ff3d3

Tip: view the complete command output by changing to the process work dir and entering the command `cat .command.out`

 -- Check '/Users/andreassjodin/Code/NanoPulse/.nf-test/tests/e8f1606feecc39d60e7dac5d5ceb3e27/meta/nextflow.log' file for details
